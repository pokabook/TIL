# CloudFront

### CloudFront

![image](https://github.com/pokabook/TIL/assets/103029701/0699c18f-d54c-4df2-a4ba-fc30d5fba487)

- 클라이언트가 인터넷에 접속하는 곳과 가까운 곳에서 컨텐츠를 캐싱해서 전 세계의 Origin Server에서 컨텐츠를 배포하는 서버 네트워크
- CDN (Contents Delivery Networks) 서비스
컨텐츠 배포 가속화 (HTML, CSS, JS, 이미지 등)
- Origin Server (원본 데이터 서버)
- Edge Location (원본 데이터 캐시)

### 특징

- 사용자에게 가까운 Edge Location에서 데이터를 전송
- 글로벌 배포
- 전세계 사용자에게 최상의 경험을 제공
- 콘텐츠 지연시간을 최소화 하면서 제공
- 비디오 콘텐츠 등의 실시간 스트리밍 배포
- 웹 사이트 속도를 높여 해외 사용자에게 향상된 브라우징 경험
- EC2 등의 Origin Server의 부하를 줄일 수 있음
- Origin Server에서 CloudFront로 전송되는 비용은 부가되지 않으므로 비용 절감 효과가 있음
- 사용자의 요청 헤더 값(최종 사용자 위치 등)에 따라 서로 다른 버전의 콘텐츠를 캐싱해 제공할 수 있음

### Price Class

|  | 북미(미국, 멕시코, 캐나다) | 유렵 및 이스라엘 | 남아프리카, 케냐, 중동 | 남아메리카 | 일본 | 호주 및 뉴질랜드 | 홍콩, 인도네시아, 필리핀, 싱가포르, 대한민국, 대만, 태국 | 인도 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Price Class All | 예 | 예 | 예 | 예 | 예 | 예 | 예 | 예 |
| Price Class 200 | 예 | 예 | 예 | 아니요 | 예 | 아니요 | 예 | 예 |
| Price Class 100 | 예 | 예 | 아니요 | 아니요 | 아니요 | 아니요 | 아니요 | 아니요 |

- 비용 절약을 위해 가격등급에 따라 배포하는 엣지 로케이션 수를 줄일 수 있음
- **Price Class All** (**전체 가격 등급**)
    - 모든 리전에 배포
- **Price Class 200** (**가격 등급 200**)
    - 대부분의 리전에 배포
- **Price Class 100** (**가격 등급 100**)
    - 일부 리전에 배포하며 가장 낮은 비용

### Origin Group

![image](https://github.com/pokabook/TIL/assets/103029701/94afcad6-9bf9-4fc0-b10c-58dcdc7d1999)

- CloudFront에 대한 고가용성
- 오리진 장애 조치를 사용하여 CloudFront를 설정
- 기본 오리진과 보조 오리진이 포함된 오리진 그룹을 생성
- 기본 오리진을 사용할 수 없거나 실패가 나타내는 특정 HTTP 응답 상태 코드를 반환하는 경우 CloudFront는 자동으로 보조 오리진으로 전환

### Lambda@Edge

- **CloudFront**를 통해 전달되는 콘텐츠를 사용자 지정하는 함수를 실행할 수 있게 해주는 **Lambda**가 확장된 컴퓨팅 서비스
- `Node.js` 또는 `Python`, `Go`, `Rust` 함수를 작성한 후 사용자와 가까운 엣지 로케이션에서 해당 함수를 실행
- 해당 **CloudFront** 이벤트가 발생할 때 **Lambda** 함수를 실행
    - **CloudFront**가 최종 사용자의 요청을 수신할 때 (최종 사용자 요청)
    - **CloudFront**가 오리진에 요청을 전달하기 전 (오리진 요청)
    - **CloudFront**가 오리진의 응답을 수신할 때 (오리진 응답)
    - **CloudFront**가 최종 사용자에게 응답을 반환하기 전 (최종 사용자 응답)
- **사용 예시**
    - User-Agent 헤더를 확인하여 사용 중인 디바이스를 기반으로 디바이스의 화면 크기에 따라 다른 이미지를 반환
    - 최종 사용자 요청 또는 오리진 요청 이벤트가 발생할 때 HTTP 응답을 생성
    - 데이터 전송 비용을 줄이기 위해 사용자에게 전송되는 파일을 압축

### 뷰어/오리진 프로토콜 정책

![image](https://github.com/pokabook/TIL/assets/103029701/efaaa153-5446-4779-a860-9ce4c38cc075)

### OAI (Origin Access Identity)

![image](https://github.com/pokabook/TIL/assets/103029701/19c70fcb-3708-4c78-994d-5621abf20f60)

- OAI (Origin Access Identity)를 통해 S3 버킷의 액세스를 CloudFront를 통해서만 하도록 할 수 있게 하는 기능

### 보안 액세스

- **Signed URL**, **Signed Cookies**
    - 서명된 **URL** 또는 쿠키를 이용하여 콘텐츠에 접속하는 기능
    - **URL** 또는 쿠키에는 콘텐츠 만료기간, 액세스 가능한 IP 주소를 저장할 수 있음
    - 유료 콘텐츠나 보안을 위해 콘텐츠의 유효/만료 기간을 지정해야 하는 경우 사용 (예, 승인된 사용자만 콘텐츠를 볼 수 있도록 허용)
    - 서명된 URL은 1개의 파일에 1개의 서명만 저장 (1개의 파일 접속을 위한 URL)
    - 서명된 쿠키는 하나의 하나의 쿠키로 여러 개의 파일 접속 가능
- **지역 제한** (**Geographic Restrictions**)
    - 특정 국가에서의 콘텐츠 액세스를 제한하는 기능
    - 법률적인 사항으로 국가별로 저작권이 다른 경우에 사용 가능
    - **2가지 지리적 제한 옵션**
        - **화이트 리스트** (**Whitelist**)
            
            리스트에 있는 국가만 액세스 허용하고 나머지는 모두 거부
            
        - **블랙리스트** (**Blacklist**)
            
            리스트에 있는 국가만 액세스 거부하고 나머지는 모두 허용
            
- **필드 레벨 암호화**
    - 사용자가 제출한 데이터를 안전하게 오리진 서버로 업로드할 수 있게 해주는 **CloudFront**의 기능
    - **PUT**, **POST** 요청이 오리진으로 전달되기 전에 엣지로케이션에서 비대칭 암호화 키를 사용하여 데이터를 추가로 암호화
    - 데이터는 프라이빗 키를 가진 애플리케이션만 복호화 할 수 있음